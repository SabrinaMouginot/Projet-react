'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h['return']&&h['return']()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_spinningIcon=require('./icons/spinningIcon'),_spinningIcon2=_interopRequireDefault(_spinningIcon),_styled=require('./styled');require('../styles.css');var _dropListIcon=require('./icons/dropListIcon'),_dropListIcon2=_interopRequireDefault(_dropListIcon),_getValidHexFormat=require('../helpers/getValidHexFormat'),_getValidRgbFormat=require('../helpers/getValidRgbFormat'),_getValidHslFormat=require('../helpers/getValidHslFormat'),_getColorInAllFormats=require('../helpers/getColorInAllFormats');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var NewColorSection=function(a){var b=a.formatPicker,c=a.defaultFormat,d=a.allowedFormats,e=a.onChange,f=a.onSuccess,g=-1===d.indexOf(c)?d[0]:c,h=(0,_react.useState)(g),i=_slicedToArray(h,2),j=i[0],k=i[1],l=(0,_react.useState)(''),m=_slicedToArray(l,2),n=m[0],o=m[1],p=(0,_react.useState)(!1),q=_slicedToArray(p,2),r=q[0],s=q[1],t=(0,_react.useState)(!1),u=_slicedToArray(t,2),v=u[0],w=u[1],x=(0,_react.useRef)(null),y=1<d.length,z=function(){var a='',b=x.current.value;if('hex'===j){if(a=b.replace('#',''),!/^([0-9A-F]{3}){1,2}$/i.test(a))return void s(!0);a='#'+a}else if('rgb'===j||'hsl'===j){if(!/^(\d{1,3}),(\d{1,3}),(\d{1,3})$/g.test(b))return void s(!0);var d=b.split(',');if('rgb'===j){if(255<d[0]||255<d[1]||255<d[2])return void s(!0);a={r:d[0],g:d[1],b:d[2]}}else if('hsl'===j){if(360<d[0]||100<d[1]||100<d[2])return void s(!0);a={h:d[0],s:d[1],l:d[2]}}}var c=(0,_getColorInAllFormats.getColorInAllFormats)(a);w(!0),setTimeout(function(){f(),e(c)},450)};return _react2.default.createElement(_styled.AddNewColorSection,null,_react2.default.createElement(_styled.AddNewColorFormat,{clickable:y,onClick:y?b.toggle:null},_react2.default.createElement('span',null,j),y&&_react2.default.createElement(_dropListIcon2.default,null)),_react2.default.createElement(_styled.AddNewColorInput,{placeholder:function b(){var a;switch(j){case'rgb':a='255,255,255';break;case'hsl':a='0\xB0,5%,100%';break;default:a='#FFFFFF';}return a}(),hasError:r,ref:x,value:n,onChange:function c(){var a='',b=x.current.value;'hex'===j?a=(0,_getValidHexFormat.getValidHexFormat)(b):'rgb'===j?a=(0,_getValidRgbFormat.getValidRgbFormat)(b):'hsl'===j&&(a=(0,_getValidHslFormat.getValidHslFormat)(b)),o(a)},onFocus:function a(){r&&s(!1)},onKeyDown:function b(a){switch(a.key){case'Enter':z();break;case'Esc':case'Escape':f();break;default:}}}),_react2.default.createElement(_styled.AddNewColorButton,{onClick:z},v?_react2.default.createElement(_spinningIcon2.default,null):'Save'),b.display&&_react2.default.createElement(_styled.FormatPicker,{ref:b.ref},d.map(function(a,c){return _react2.default.createElement(_styled.FormatPickerItem,{key:a,active:a===j,isLast:c===d.length-1,onClick:function c(){k(a),s(!1),o(''),b.toggle()}},a)})))};exports.default=NewColorSection;